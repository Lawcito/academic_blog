{% extends "base.html" %}
{% load static %}

{% block title %}Inicio - Blog Acad√©mico{% endblock %}

{% block video_background %}
<div class="video-background-layer"
  style="position: fixed; top: 170px; left: 0; width: 100%; height: 350px; z-index: 1;">
  <video autoplay muted loop id="myVideo" class="video-background-element"
    style="min-width: 100%; min-height: 100%; width: auto; height: auto; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); object-fit: cover;">
    <source src="{% static 'video/fondo_programacion.mp4' %}" type="video/mp4">
  </video>
  <div class="video-overlay"
    style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(4, 26, 75, 0.75);"></div>
</div>
{% endblock %}

{% block content %}

<div style="height: 350px;">
  <div class="text-center position-absolute w-100 start-0"
    style="top: 250px; transform: translateY(-50%); z-index: 100;">
    <h1 class="display-4 fw-bold text-white" style="text-shadow: 
            -1px -1px 0 #000, 
             1px -1px 0 #000, 
            -1px 1px 0 #000, 
             1px 1px 0 #000, 
             0 0 10px #000; 
            letter-spacing: 1px;">
      Bienvenidos
    </h1>
    <p class="lead text-white" style="text-shadow: 
            -1px -1px 0 #000, 
             1px -1px 0 #000, 
             0 0 5px #000;">Portal de la Tecnicatura
      Universitaria en Programaci√≥n - UTN FRLP</p>
  </div>
</div>


<div class="p-4 rounded-4 border border-dark-subtle bg-panel">
  <div class="row">

    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm border-custom-primary">
        <div class="card-header bg-transparent text-center border-custom-primary-bottom">
          <h5 class="mb-0 text-info">üìÖ Calendario Acad√©mico</h5>
        </div>
        <div class="card-body p-0">
          <img src="{% static 'img/calendario_2025.jpg' %}" class="img-fluid" alt="Calendario 2025"
            style="width: 100%; height: auto;">

          <div class="p-3">
            <ul class="list-group list-group-flush small">
              {% for evento in eventos %}
              <li class="list-group-item bg-transparent text-white">
                <strong class="text-info">{{ evento.fecha|date:"d/m" }}:</strong> {{ evento.titulo }}
              </li>
              {% empty %}
              <li class="list-group-item bg-transparent text-secondary">No hay eventos pr√≥ximos.</li>
              {% endfor %}
            </ul>
            <div class="d-grid mt-3">
              <a href="#" class="btn btn-outline-info btn-sm">Ver calendario completo</a>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm border-custom-success">
        <div class="card-header bg-transparent text-center border-custom-success-bottom">
          <h5 class="mb-0 text-success">üì∞ √öltimas Noticias</h5>
        </div>

        <div class="card-body overflow-auto" style="max-height: 500px;">
          {% for articulo in articulos %}
          <div class="card mb-3 border-0 shadow-none bg-transparent">
            <div class="row g-0">
              {% if articulo.imagen %}
              <div class="col-4">
                <img src="{{ articulo.imagen.url }}" class="img-fluid rounded-start h-100" style="object-fit: cover;"
                  alt="img">
              </div>
              {% endif %}
              <div class="col-{% if articulo.imagen %}8{% else %}12{% endif %}">
                <div class="card-body p-2 text-white">
                  <h6 class="card-title mb-1" style="font-size: 0.9rem; font-weight: bold;">
                    <a href="{% url 'blog_edicion:articulo_detalle' pk=articulo.pk %}"
                      class="text-decoration-none text-white">
                      {{ articulo.titulo }}
                    </a>
                  </h6>

                  <p class="card-text small mb-1 text-light">
                    {{ articulo.bajada|default:articulo.cuerpo|truncatewords:8 }}
                  </p>

                  <div class="d-flex justify-content-between align-items-center mt-2">
                    <small class="text-success" style="font-size: 0.7rem;">
                      {{ articulo.fecha_publicacion|date:"d M Y" }}
                    </small>

                    {% if user.is_authenticated and user == articulo.autor %}
                    <div>
                      <a href="{% url 'blog_edicion:editar_articulo' pk=articulo.pk %}"
                        class="badge bg-warning text-dark text-decoration-none">Editar</a>
                      <a href="{% url 'blog_edicion:eliminar_articulo' pk=articulo.pk %}"
                        class="badge bg-danger text-white text-decoration-none">Eliminar</a>
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
          <hr class="my-1 border-secondary">
          {% empty %}
          <p class="text-center mt-4 fw-bold text-white">No hay novedades por ahora.</p>
          {% endfor %}
        </div>

        <div class="card-footer bg-transparent text-center">
          <a href="{% url 'blog_edicion:ver_todas_noticias' %}" class="btn btn-outline-success btn-sm w-100">
            Ir al muro de noticias &rarr;
          </a>
        </div>
      </div>
    </div>

    <div class="col-md-4 mb-4">
      <div class="card h-100 shadow-sm border-custom-info">
        <div class="card-header bg-transparent text-center border-custom-info-bottom">
          <h5 class="mb-0 text-info">üìÅ Apuntes y Parciales</h5>
        </div>
        <div class="card-body text-center d-flex flex-column justify-content-center">

          <div class="mb-3">
            <i class="fas fa-folder-open fa-3x text-info mb-3"></i>
            <p class="card-text fw-medium text-white">
              Acced√© al repositorio de materiales de estudio, organizados por materia y carrera.
            </p>
          </div>

          <div class="d-grid gap-2">
            <a href="{% url 'blog_edicion:subir_apunte' %}" class="btn btn-info text-white fw-bold">
              ‚¨Ü Subir un Apunte
            </a>
            <a href="{% url 'blog_edicion:buscar_apuntes' %}" class="btn btn-outline-info">
              üîç Buscar Material
            </a>
          </div>

          <div class="mt-4 text-start small">
            <p class="fw-bold mb-1 text-info">Destacados (√öltimos subidos):</p>
            <ul class="list-unstyled">
              {% for apunte in apuntes %}
              <li class="mb-2">
                <a href="{{ apunte.archivo.url }}" class="text-decoration-none text-white" target="_blank">
                  <strong>üìÑ {{ apunte.titulo }}</strong>
                  <span class="text-secondary">({{ apunte.materia.nombre }})</span>
                </a>
              </li>
              {% empty %}
              <li class="text-secondary">A√∫n no hay apuntes subidos.</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}