{% extends "base.html" %}
{% load static %}

{% block title %}Inicio - Aula Abierta{% endblock %}

{% block content %}

<h1 class="text-center mb-4">Bienvenido!</h1>
<h2 class="text-center mb-4">Artículos más recientes</h2>

<div class="d-flex justify-content-between align-items-center mb-3">

  <button class="btn btn-primary d-flex align-items-center gap-2" type="button"
          data-bs-toggle="offcanvas" data-bs-target="#sidebarFiltros">
    Buscar y Filtrar
  </button>

  <div class="d-none d-md-flex btn-group">
    <button type="button" class="btn btn-outline-secondary active"
            id="btn-grilla" onclick="cambiarVista('grilla')">
      Grilla
    </button>
    <button type="button" class="btn btn-outline-secondary"
            id="btn-lista" onclick="cambiarVista('lista')">
      Lista
    </button>
  </div>
</div>

<div class="row">
  {% for articulo in articulos %}
  <div class="articulo-col col-md-6 col-lg-6 mb-4">

    <div class="card h-100 shadow-sm border-0">
      <div class="card-body d-flex align-items-start">

        {% if articulo.imagen_static %}
        <div class="flex-shrink-0">
          <img src="{% static 'img/articulos/'|add:articulo.imagen_static %}"
               alt="{{ articulo.titulo }}"
               class="rounded"
               style="width:80px;height:80px;object-fit:cover;">
        </div>
        {% endif %}

        <div class="flex-grow-1 ms-3">
          <h5 class="fw-bold mb-1">{{ articulo.titulo }}</h5>
          <p class="small text-muted mb-2">
            {{ articulo.contenido|truncatewords:10 }}
          </p>
          <a href="{% url 'blog_edicion:articulo_detalle' pk=articulo.pk %}"
             class="btn btn-outline-primary btn-sm">
            Leer más
          </a>
        </div>

      </div>

      <div class="card-footer bg-transparent text-end">
        <small class="text-muted">
          {{ articulo.fecha_publicacion|date:"d/m/Y" }}
        </small>
      </div>
    </div>

  </div>
  {% empty %}
    <p class="text-center">No hay artículos para mostrar.</p>
  {% endfor %}
</div>

<!-- OFFCANVAS -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="sidebarFiltros">
  <div class="offcanvas-header">
    <h5>Explorar artículos</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>

  <div class="offcanvas-body">
    <form method="get">
      <div class="mb-3">
        <input type="text" name="q" class="form-control"
               placeholder="Buscar..."
               value="{{ request.GET.q|default:'' }}">
      </div>

      <div class="mb-3">
        {% for cat in categorias %}
        <button class="btn btn-outline-secondary w-100 mb-1"
                name="categoria" value="{{ cat.id }}">
          {{ cat.nombre }}
        </button>
        {% endfor %}
      </div>

      <a href="{% url 'home' %}" class="btn btn-danger w-100">
        Limpiar filtros
      </a>
    </form>
  </div>
</div>

{% endblock %}

{% block scripts %}
<script>
function cambiarVista(modo) {
  const cols = document.querySelectorAll('.articulo-col');
  if (modo === 'lista') {
    cols.forEach(c => {
      c.classList.remove('col-md-6','col-lg-6');
      c.classList.add('col-12');
    });
  } else {
    cols.forEach(c => {
      c.classList.remove('col-12');
      c.classList.add('col-md-6','col-lg-6');
    });
  }
}
</script>
{% endblock %}
